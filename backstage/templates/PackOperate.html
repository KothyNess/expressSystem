{% extends 'BackStagelayout.html' %}
{% load static %}

{% block title %}
    包裹 — 编辑
{% endblock %}

{% block slider %}
    <!-- Page Sidebar -->
    <div class="page-sidebar">
        <a class="logo-box" href="/backstage/statistic/time">
            <span>快递后台管理</span>
            <i class="icon-radio_button_unchecked" id="fixed-sidebar-toggle-button"></i>
            <i class="icon-close" id="sidebar-toggle-button-close"></i>
        </a>
        <div class="page-sidebar-inner">
            <div class="page-sidebar-menu">
                <ul class="accordion-menu">
                    <li>
                        <a href="javascript:void(0)">
                            <i class="menu-icon icon-flash_on"></i><span>综合统计</span><i
                                class="accordion-icon fa fa-angle-left"></i>
                        </a>
                        <ul class="sub-menu">
                            <li><a href="/backstage/statistic/time">按时间统计</a></li>
                            <li><a href="/backstage/statistic/company">按分公司统计</a></li>
                            <li><a href="/backstage/statistic/station">按分站统计</a></li>
                            <li><a href="/backstage/statistic/staff">按快递员统计</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="/backstage/company/">
                            <i class="menu-icon icon-home"></i><span>分公司管理</span>
                        </a>
                    </li>
                    <li>
                        <a href="/backstage/station/">
                            <i class="menu-icon icon-home2"></i><span>分站管理</span>
                        </a>
                    </li>
                    <li >
                        <a href="/backstage/staff/">
                            <i class="menu-icon icon-person"></i><span>快递员管理</span>
                        </a>
                    </li>
                    <li class="active-page">
                        <a href="/backstage/Pack/">
                            <i class="menu-icon icon-add_box"></i><span>揽件管理</span>
                        </a>
                    </li>
                    <li>
                        <a href="/backstage/deliverPack/">
                            <i class="menu-icon icon-send"></i><span>发货管理</span>
                        </a>
                    </li>

                </ul>
            </div>
        </div>
    </div><!-- /Page Sidebar -->
{% endblock %}

{% block PageContent %}
    <!-- Page Content -->
    <div class="page-content">
        <!-- Page Header -->
        <div class="page-header">
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <div class="logo-sm">
                            <a href="javascript:void(0)" id="sidebar-toggle-button"><i class="fa fa-bars"></i></a>
                        </div>
                        <div class="dropdown-toggle navbar-toggle">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false">
                                <p>{{ admin_name }}</p>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="/backstage/adminLogout/">登出</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <li>
                                <a href="javascript:void(0)" id="toggle-fullscreen"><i class="fa fa-expand"></i></a>
                            </li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li class="dropdown user-dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                   aria-haspopup="true" aria-expanded="false">
                                    <h4>欢迎你：{{ admin_name }}</h4>
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a href="/backstage/adminLogout/">登出</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div><!-- navbar-collapse -->
                </div><!-- /.container-fluid -->
            </nav>
        </div><!-- /Page Header -->
        <!-- Page Inner -->
        <div class="page-inner cd-container no-page-title">
            <div id="main-wrapper">
                <div class="row">
                    <div class="col-md-3">
                        <div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-white">
                            <div class="panel-body">
                                <div class="panel-heading clearfix">
                                    <h4 class="panel-title">修改包裹</h4>
                                </div>
                                <div class="panel-body">
                                    <form method="post">
                                        {% csrf_token %}
                                        <input type="text" hidden value="{{ pack_info.timestamp }}" name="packID"
                                               id="packID">
                                        <div class="form-group">
                                            <label for="object_name">快递包裹物品</label>
                                            <input type="text" class="form-control" id="object_name"
                                                   name="object_name" placeholder="包裹物品名称"
                                                   value="{% if pack_info.object_name %}{{ pack_info.object_name }}{% endif %}"
                                                   required>
                                        </div>
                                        <div class="form-group">
                                            <label for="weight">重量</label>
                                            <input type="text" class="form-control" id="weight"
                                                   name="weight" placeholder="重量（KG）"
                                                   value="{% if pack_info.weight %}{{ pack_info.weight }}{% endif %}"
                                                   required>
                                        </div>
                                        <div class="form-group">
                                            <label for="username">发件人姓名</label>
                                            <input type="text" class="form-control" id="username"
                                                   name="username" placeholder="发件人姓名"
                                                   value="{% if pack_info.user.username %}{{ pack_info.user.username }}{% endif %}"
                                                   required>
                                        </div>
                                        <div class="form-group">
                                            <label for="phone_number">发件人手机号</label>
                                            <input type="text" class="form-control" id="phone_number"
                                                   name="phone_number" placeholder="发件人手机号"
                                                   value="{% if pack_info.user.phone_number %}{{ pack_info.user.phone_number }}{% endif %}"
                                                   required>
                                        </div>
                                        <div class="form-group">
                                            <label for="recipient_number">收件人姓名</label>
                                            <input type="text" class="form-control" id="recipient"
                                                   name="recipient" placeholder="发件人手机号"
                                                   value="{% if pack_info.recipient.username %}{{ pack_info.recipient.username }}{% endif %}"
                                                   required>
                                        </div>
                                        <div class="form-group">
                                            <label for="recipient_number">发件人手机号</label>
                                            <input type="text" class="form-control" id="recipient_number"
                                                   name="recipient_number" placeholder="发件人手机号"
                                                   value="{% if pack_info.recipient.phone_number %}{{ pack_info.recipient.phone_number }}{% endif %}"
                                                   required>
                                        </div>
                                        <div class="form-group ">
                                            <label for="get_company">发件地</label>
                                            <select style="margin-bottom:15px;" class="form-control" id="get_company"
                                                    name="get_company">
                                                {% for company in companies %}
                                                    <option value="{{ company.id }}"
                                                            {% if selected_get_company == company.id %}selected{% endif %}>{{ company.city }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="form-group ">
                                            <label for="get_station">发件快递站</label>
                                            <select style="margin-bottom:15px;" class="form-control" id="get_station"
                                                    name="get_station">
                                                {% for station in stations %}
                                                    <option value="{{ station.id }}"
                                                            {% if selected_get_station == station.id %}selected{% endif %}>{{ station.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="deliver_company">收件地</label>
                                            <select style="margin-bottom:15px;" class="form-control"
                                                    id="deliver_company"
                                                    name="deliver_company">
                                                {% for company in companies %}
                                                    <option value="{{ company.id }}"
                                                            {% if selected_deliver_company == company.id %}selected{% endif %}>{{ company.city }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="deliver_station">收件快递站</label>
                                            <select style="margin-bottom:15px;" class="form-control"
                                                    id="deliver_station"
                                                    name="deliver_station">
                                                {% for station in stations %}
                                                    <option value="{{ station.id }}"
                                                            {% if selected_deliver_station == station.id %}selected{% endif %}>{{ station.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        {% if error %}
                                            <p style="color: #8b211e;font-size: 12px;">{{ error }}</p>
                                        {% endif %}
                                        <div class="company_add_form">
                                            <div style="max-width: 200px; margin: 0 auto;">
                                                <button type="submit" class="btn btn-primary">提 &nbsp;&nbsp; 交
                                                </button>
                                                <a href="/backstage/Pack/" class="btn btn-default">取 &nbsp;&nbsp;
                                                    消</a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div>
                        </div>
                    </div>
                </div><!-- Row -->
            </div><!-- /Page Content -->
        </div>
    </div>
{% endblock %}
{% block js %}
    <script>
        $(document).ready(function () {

            var selected_station = "{{ selected_station }}"; // 假设从后端获取

            function getStations(company) {
                $.ajax({
                    url: '/get_stations/',
                    data: {
                        'company': company
                    },
                    dataType: 'json',
                    success: function (data) {
                        var select = $("#get_station");
                        select.empty();
                        $.each(data, function (index, value) {
                            var option = $('<option></option>').attr('value', value.id).text(value.name);

                            // 这里加入逻辑来判断哪个选项应该被选中
                            if (selected_station == value.id) {
                                option.attr('selected', 'selected');
                            }

                            select.append(option);
                        });
                    }
                });
            }

            var initialCompanyId = $("#get_company").val();
            if (initialCompanyId !== null && initialCompanyId !== undefined) {
                getStations(initialCompanyId);
            }

            $("#get_company").change(function () {
                var companyId = $(this).val();
                if (companyId !== null && companyId !== undefined) {
                    getStations(companyId);
                }
            });
        });
    </script>
    <script>
        $(document).ready(function () {

            var selected_station = "{{ selected_station }}"; // 假设从后端获取

            function getStations(company) {
                $.ajax({
                    url: '/get_stations/',
                    data: {
                        'company': company
                    },
                    dataType: 'json',
                    success: function (data) {
                        var select = $("#deliver_station");
                        select.empty();
                        $.each(data, function (index, value) {
                            var option = $('<option></option>').attr('value', value.id).text(value.name);

                            // 这里加入逻辑来判断哪个选项应该被选中
                            if (selected_station == value.id) {
                                option.attr('selected', 'selected');
                            }

                            select.append(option);
                        });
                    }
                });
            }

            var initialCompanyId = $("#deliver_company").val();
            if (initialCompanyId !== null && initialCompanyId !== undefined) {
                getStations(initialCompanyId);
            }

            $("#deliver_company").change(function () {
                var companyId = $(this).val();
                if (companyId !== null && companyId !== undefined) {
                    getStations(companyId);
                }
            });
        });
    </script>
{% endblock %}